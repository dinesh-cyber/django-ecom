{%load static%}
{% load product_tags %}
<!DOCTYPE html>
<html lang="fr">

<head>
    <!-- Site meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Free Bootstrap 4 Ecommerce Template</title>
    <!-- CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css">
    <link href="{%static 'css/style.css' %}" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="{%static 'css/util.css' %}">
    <link rel="stylesheet" type="text/css" href="{%static 'css/main.css' %}">
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">Simple Ecommerce</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarsExampleDefault">
                <ul class="navbar-nav m-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{%url 'category'%}">Categories</a>
                        {{request.session.name}}

                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{%url 'contact'%}">Contact</a>
                    </li>
                </ul>
                <!--                 <form class="form-inline my-2 my-lg-0">
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control" placeholder="Search...">
                        <div class="input-group-append">
                            <button type="button" class="btn btn-secondary btn-number">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                </form> -->
                {% if user.is_authenticated %}
                <a class="btn btn-success btn-sm ml-3" id="logout" href="{%url 'logout' %}">
                    Logout
                </a>
                {%else%}
                <a class="btn btn-success btn-sm ml-3 my_btn">
                    Login
                </a>
                {%endif%}
                <a class="btn btn-success btn-sm ml-3" href="{%url 'cart'%}">
                    <i class="fa fa-shopping-cart"></i> Cart
                        {% if user.is_authenticated %}
                            <span class="badge badge-light">{% cart_count request.user.id %}</span>
                        {%else%}
                            <span class="badge badge-light">{{product_count}}</span>
                        {%endif%}
                </a>
            </div>
        </div>
    </nav>

<div class="row" >   
    <div class="container" >
    <div class="col-12" >
    <div id="myModal" class="modal modal_start">
        <div class="modal-content login_modal_style">
            <div class="container">
                <div class="modal_cross_style">
                    <a href="#" id='modal_close'>
                        <i class="fa fa-close"></i>
                    </a>
                </div>
                <form class="needs-validation" id="login_data" novalidate onsubmit="login_function(event)">
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" class="form-control" id="username"  required >
                        <div class="invalid-feedback" >
                            Please enter valid username
                        </div>
                        <div  id="login_error">
                            
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" class="form-control" id="password" required>
                        <div class="invalid-feedback">
                            Please enter Password
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-success btn-ladda" data-style="contract">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</div>
</div>
    {% block body %}
    {% endblock %}
    <!-- JS -->
    <script src="//code.jquery.com/jquery-3.2.1.slim.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" type="text/javascript"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
</body>
<!-- Footer -->
<footer class="text-light">
    <div class="container">
        <div class="row">
            <div class="col-md-3 col-lg-4 col-xl-3">
                <h5>About</h5>
                <hr class="bg-white mb-2 mt-0 d-inline-block mx-auto w-25">
                <p class="mb-0">
                    Le Lorem Ipsum est simplement du faux texte employ√© dans la composition et la mise en page avant impression.
                </p>
            </div>
            <div class="col-md-2 col-lg-2 col-xl-2 mx-auto">
                <h5>Informations</h5>
                <hr class="bg-white mb-2 mt-0 d-inline-block mx-auto w-25">
                <ul class="list-unstyled">
                    <li><a href="">Link 1</a></li>
                    <li><a href="">Link 2</a></li>
                    <li><a href="">Link 3</a></li>
                    <li><a href="">Link 4</a></li>
                </ul>
            </div>
            <div class="col-md-3 col-lg-2 col-xl-2 mx-auto">
                <h5>Others links</h5>
                <hr class="bg-white mb-2 mt-0 d-inline-block mx-auto w-25">
                <ul class="list-unstyled">
                    <li><a href="">Link 1</a></li>
                    <li><a href="">Link 2</a></li>
                    <li><a href="">Link 3</a></li>
                    <li><a href="">Link 4</a></li>
                </ul>
            </div>
            <div class="col-md-4 col-lg-3 col-xl-3">
                <h5>Contact</h5>
                <hr class="bg-white mb-2 mt-0 d-inline-block mx-auto w-25">
                <ul class="list-unstyled">
                    <li><i class="fa fa-home mr-2"></i> My company</li>
                    <li><i class="fa fa-envelope mr-2"></i> email@example.com</li>
                    <li><i class="fa fa-phone mr-2"></i> + 33 12 14 15 16</li>
                    <li><i class="fa fa-print mr-2"></i> + 33 12 14 15 16</li>
                </ul>
            </div>
            <div class="col-12 copyright mt-3">
                <p class="float-left">
                    <a href="#">Back to top</a>
                </p>
                <p class="text-right text-muted">created with <i class="fa fa-heart"></i> by <a href="https://t-php.fr/43-theme-ecommerce-bootstrap-4.html"><i>t-php</i></a> | <span>v. 1.0</span></p>
            </div>
        </div>
    </div>
</footer>
<script type="text/javascript">
var modal = document.getElementById("myModal");
$('.my_btn').click(function(e) {
    modal.style.display = "block";
});

window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
$('#modal_close').click(function(e) {
    modal.style.display = "none";
})

// $('a#logout').on('click', function(e) {
//   e.preventDefault();

//   var isConfirmed = $.confirm({
//     title: 'Logout Confirmation',
//     content: 'Are you sure you want to logout?',
//     buttons: {
//       confirm: function() {
//         window.location.href = "extra-login.html";
//       },
//       cancel: function() {},
//     }
//   });
// });

//login validation
window.addEventListener('load', function() {
    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.getElementsByClassName('needs-validation');
    // Loop over them and prevent submission
    var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });
}, false);
//end validaion

$('#username').keydown(function(){
  $('#login_error').empty()
})



function login_function(event) {
    event.preventDefault();
    username = $('#username').val()
    password = $('#password').val()
    if (username != '' && password != '') {
        $.ajax({
            url: "{%url 'login' %}", // the endpoint
            type: "POST", // http method
            data: {
                username: username,
                password: password
            }, // data sent with the post request
            // handle a successful response
            success: function(data) {
                console.log("done")
                if (data == 'success') {
                    location.reload();
                } // another sanity check
                else {
                    $('#login_error').html("Your username or password is incorrect")
                }
            },
        });
    }
}
</script>


<script type="text/javascript">
// add product to cart
    $('a[name="product_id').click(function(){
        var dataId = $(this).attr("data-id");
        var quantity = $('#quantity').val()
        $.ajax({
             url: '{%url 'add_to_cart'  %}',
              data: {
                "quantity"  : quantity,
                "product_id" : dataId,
              },
               success: function(data) {
                if (data == "success"){
                    location.reload();
                }
                else {
                    location.reload(); 
                }
               }
        });
    })
</script>



<script type="text/javascript">
//Plus & Minus for Quantity produc
$(document).ready(function() {
    var quantity = 1;

    $('.quantity-right-plus').click(function(e) {
        e.preventDefault();
        var quantity = parseInt($('#quantity').val());
        // $('#quantity').val(quantity + 1);
        $('#quantity').attr('value', quantity + 1);


    });

    $('.quantity-left-minus').click(function(e) {
        e.preventDefault();
        var quantity = parseInt($('#quantity').val());
        if (quantity > 1) {
            $('#quantity').val(quantity - 1);
        }
    });

});

$(document).ready(function() {
    var url = window.location;
    $('ul.navbar-nav a[href="' + url + '"]').parent().addClass('active');
    $('ul.navbar-nav a').filter(function() {
        return this.href == url;
    }).parent().addClass('active');
});
</script>
{%block js%}
{%endblock%}

</html>